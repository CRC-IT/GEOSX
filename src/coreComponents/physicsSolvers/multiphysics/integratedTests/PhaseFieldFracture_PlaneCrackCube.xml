<!-- This solves a manufactured problem, Lap(U) + U = F, with U = 0 in all the walls. F is constructed such that the analytical solution is simply U(x,y,z) = xyz(1-x)(1-y)(1-z)-->
<Problem>

  <Solvers>
    <PhaseFieldFracture name="PhaseFieldSolve" 
                 solidSolverName="SolidMechSolve"
                 damageSolverName="RDSolve"
                 couplingTypeOption="FixedStress"
                 logLevel="1"
                 discretization="FE1"
                 targetRegions="{Region1}">
      <SystemSolverParameters maxIterNewton="40"
                              logLevel="2"/>
    </PhaseFieldFracture>
    
    <SolidMechanicsLagrangianSSLE name="SolidMechSolve" 
                                  timeIntegrationOption="QuasiStatic"
                                  logLevel="1"
                                  discretization="FE1"
                                  targetRegions="{Region1}"
                                  solidMaterialName="shale"
                                  >
      <SystemSolverParameters krylovTol="1.0e-10"
                              newtonTol="1.0e-6"
                              maxIterNewton="5"
                              logLevel="2"/>
    </SolidMechanicsLagrangianSSLE>

    <ReactionDiffusionFEM name="RDSolve"
                discretization="FE1"
                timeIntegrationOption="SteadyState"
                fieldName="Temperature"
                logLevel="0"
                targetRegions="{Region1}">
    </ReactionDiffusionFEM>
  </Solvers>

  <Mesh>
    <InternalMesh name="mesh1"
                  elementTypes="{C3D8}"
                  xCoords="{-1, 1}"
                  yCoords="{-1, 1}"
                  zCoords="{-1, 1}"
                  nx="{10}"
                  ny="{10}"
                  nz="{10}"
                  cellBlockNames="{cb1}"/>
  </Mesh>

  <Events maxTime="1.0">
    <!-- This event is applied every cycle, and overrides the
    solver time-step request -->
    <PeriodicEvent name="solverApplications"
                   forceDt="1.0"
                   target="/Solvers/PhaseFieldSolve" />

    <!-- This event is applied every 1.0s.  The targetExactTimestep
    flag allows this event to request a dt modification to match an
    integer multiple of the timeFrequency. -->
    <!--PeriodicEvent name="outputs"
                   timeFrequency="1.0"
                   targetExactTimestep="1"
                   target="/Outputs/VTKOutput" /-->

    <PeriodicEvent name="outputs"
                   timeFrequency="1.0"
                   targetExactTimestep="1"
                   target="/Outputs/SiloOutput"/>

    <PeriodicEvent name="restarts"
                   timeFrequency="1e99"
                   targetExactTimestep="0"
                   target="/Outputs/restartOutput"
                   endTime="-1" />
  </Events>

  <NumericalMethods>
    <BasisFunctions>
      <LagrangeBasis3 name="linearBasis"  degree = "1"  />
    </BasisFunctions>
    <QuadratureRules>
      <GaussQuadrature3 name="gaussian"   degree="2"  />
    </QuadratureRules>
    <FiniteElements>
      <FiniteElementSpace name="FE1" parentSpace="C3D8" basis="linearBasis" quadrature="gaussian" />
    </FiniteElements>
  </NumericalMethods>

  <ElementRegions>
    <CellElementRegion name="Region1" cellBlocks="{cb1}" materialList="{shale}" />
  </ElementRegions>

  <Constitutive>
    <LinearElasticIsotropic name="shale"
                            defaultDensity="2700"
                            defaultBulkModulus="5.5556e9"
                            defaultShearModulus="4.16667e9"/>
  </Constitutive>

  <FieldSpecifications>
    <!--<FieldSpecification name="boundary"
                        fieldName="Temperature"
                        objectPath="nodeManager"
                        scale="0"
                        setNames="{xneg, xpos, yneg, ypos, zneg, zpos}"/> -->
    <FieldSpecification name="xconstraint0" 
               objectPath="nodeManager" 
               fieldName="TotalDisplacement" 
               component="0" 
               scale="-0.10" 
               setNames="{xneg}"/>

    <FieldSpecification name="xconstraint1" 
               objectPath="nodeManager" 
               fieldName="TotalDisplacement" 
               component="0" 
               scale="0.10" 
               setNames="{xpos}"/>

    <FieldSpecification name="yconstraint"    
               objectPath="nodeManager" 
               fieldName="TotalDisplacement" 
               component="1" 
               scale="0.0" 
               setNames="{yneg, ypos}"/>
               
    <FieldSpecification name="zconstraint"    
               objectPath="nodeManager" 
               fieldName="TotalDisplacement" 
               component="2" 
               scale="0.0" 
               setNames="{zneg, zpos}"/>
               
    <FieldSpecification name="pointSource"
                        fieldName="Temperature"
                        objectPath="nodeManager"
                        scale="1"
                        setNames="{centerLine}"/>

    <FieldSpecification name="diffusionCoeff"
                        initialCondition="1"
                        setNames="{all}"
                        objectPath="ElementRegions"
                        fieldName="coeffField"
                        scale="2e3"
                        functionName="f_b"
                        />
  </FieldSpecifications>


  <Functions>
    <!-- These are example mathpresso functions.  In order to use them, you need to specify the order that the
    symbolic math function should expect the variables to be given, and an expression that it will compile.
    A list of available functions is given here: https://github.com/kobalicek/mathpresso -->
    <SymbolicFunction name="f_b"
                      inputVarNames="{elementCenter}"
                      variableNames="{x, y, z}"
                      expression="0"/>

  </Functions>
  <Outputs>
    <Silo name="SiloOutput" parallelThreads="1" plotFileRoot="plot"/>
    <VTK name="VTKOutput" parallelThreads="1" plotFileRoot="plot"/>
    <Restart name="restartOutput"/>
  </Outputs>

  <Geometry>
    <Box name="centerLine" xMin="-0.001, -1.001, -1.001" xMax="+0.001, +0.001, +1.001"/>
  </Geometry>

</Problem>
